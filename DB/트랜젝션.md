# **트랜젝션(Transaction)**

JPA 활용 강의를 듣던 중에 트랜젝션을 DB관련 처리에서 반드시 붙여주는 경우가 많았다.

트랜젝션 용어 자체는 익숙하게도 많이 들어봤지만 이를 명확하게 알아본 적이 없어 이를 정리해보고자 한다.

<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>

## **트랜잭션이란?**

트랜젝션은 **데이터베이스의 상태를 변화시키는 작업의 논리적인 단위**를의미한다.

즉 데이터 베이스의 상태를 변화하는 CRUD 작업을 의미한다. SQL 쿼리문에서 사용하는 SELECT,INSERT,DELETE,UPDATE 등 데이터조작어를 의미한다.

이런 트랜잭션은 상황에 따라서 여러개가 있을 수 도 있고, 상황에 따라 Commit, Rollback 될 수 있다.

#### **◼ 트랜젝션 사용 이유**

은행 입출금상황을 한번 가정해보자

국민 통장에서 우리 통장으로 송금하는 상황이다.

송금중에서 만약 돈이 국민은행에서 출금되었는데 우리은행에서 입금되지 않은 상황이다.

이런 상황을 막기 위해서는 거래가 모두 끝나는 것, 즉 송금 확인과 입금 확인 과정이 모두 이루어져야 완전한 거래라고 인식하게끔 하는것이다.

이때 중간에 거래가 비정상 종료 되거나 하는 상황이 발생하면 이를 정상 거래로 인식하지 않고 원래 상태로 돌려야 하는 것이다.

즉 이런 상황, 데이터 처리과정에서 안정성을 확보하는 방법이 트랜잭션이다.

데이터베이스에는 테이블로 읽어온 데이터를 갱신, 삭제 하는 처리 중 **에러가 발생하면 이를 롤백**하고, 모든 과정이 **올바르게 처리되면 이를 커밋**한다.

#### **◼ 트랜젝션의 의미**

\- 트랜젝션은 데이터베이스 시스템에서 병행 및 회복 작업에서 처리되는 작업의 논리 단위

\- 사용자가 시스템에 대한 서비스 요구 시 응답하기 위한 상태 변환 과정의 작업단위

\- 하나의 트랜젝션은 롤백 또는 커밋

## **트랜젝션의 특징**

트랜젝션의 특징은 ACID라고 불린다.

Atomicity, Consitenct, Isolation, Durability 4가지의 특징을 의미한다.

#### **◼ 원자성(Atomicity )**

**트랜젝션의 작업이 부분적으로 실행되거나 중단되지 않는 것을 보장**한다. 즉 DB에 모든 처리가 반영되거나, 안되거나 둘중 하나를 반드시 보장해야하는 것이다.

트랜젝션에서 원자성은 수행는 트랜젝션에 의해 변경된 내역을 유지하면서 이전 커밋 상태를 임시 영역에 따로 저장함으로 이를 보장한다.

트랜젝션에서 오류가 발생하면 현재 내역을 버리고 임시 영역에 저장한 상태로 롤백시키는 것이다.

임시 저장소를 롤백 세그먼트(Rollback Segment) 라고 한다. 수정되기 전의 파일, 블록ID등 블럭 정보와 데이터를 저장한다. 현재 실행하는 트랜젝션에 의해서 새롭게 변경되는 내역을 DB 테이블이라고 한다.

#### **◼ 일관성(Consitenct )**

트랜젝션의 작업 처리 결과는 항상 일관되야 한다. 예시를 통해서 한번 이해해보자

> 작성된 테이블이 글자 제한이 300글자인데, 트랜젝션이 일어나면 글자 제한 조건을 만족해야만 트랜젝션이 수행되고 위반되면 실행되지 않아야한다.

즉 트랜젝션 수행 전과 후에 데이터 모델의 모든 제약조건을 만족해야하는 것이다.

일관성 보장은 어떤 이벤트와 조건이 발생시 트리거를 통해서 이를 보장한다.

**✅ 트리거 (Trigger)**

트리거는 특정 테이블에 INSERT, DELETE, UPDATE 등 DML 명령이 실행되면 DB에서 자동으로 동작하게 작성된 프로그램이다. 예를 들자면 A 테이블의 정보가 변경시 B테이블에서도 함께 정보가 변경되도록 하는 명시적인 자동 업데이트와 같은 명령을 의미한다.

#### **◼고립성( Isolation )**

트랜젝션 명령 수행시 다른 트랜젝션 작업이 참여하게 하면 안되도록 보장한다.

두개 이상의 트랙젝션이 병렬처리를 한다면 이때 어떤 트랜젝션도 다른 트랜젝션 작업에 끼어들수 없다.

이를 위해서 Lock/Unlock 을 사용한다.

**✅ Lock/UnLock**

개발시 쓰레드를 사용하는 것과 비슷한 개념이다.

쓰기나 읽기 작업 중에 해당 영역에 Lock을 걸어서 다른 트랜젝션의 접근을 막고 해당 트랜젝션의 요청이 끝나면 Unlock을 통해서 접근을 허용하는 것이다. 이를 통해서 고립성을 보장할 수 있다.

하지만 이때 DeadLock상태가 발생할 수도 있기때문에 잘 고려해야한다.

#### **◼ 지속성(Durability )**

성공된 트랙젝션은 영원히 반영되야 한다.

예를 들어서 어떤 작업을 통해서 DB의 A 테이블 값을 바꾸면 바꾼 값을 영원히 다음 변경 이전에는 바뀌면 안되는 것이다.

<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
