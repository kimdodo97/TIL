![](https://velog.velcdn.com/images/kimdodo/post/dd6944ab-6865-4cab-bed7-2da7eb48351e/image.png)
이런 HTML 폼이 존재할때 이름과 나이를 입력하고 전송을 누르면 url이 /save가 되고 POST 방식으로 리퀘스트 요청

웹 브라우저가 HTTP 메세지를 만들고 POST 방법으로 리퀘스트를 요청하는 것이다.

![](https://velog.velcdn.com/images/kimdodo/post/465be27e-0fa1-4ac4-aae2-e8fa19386700/image.png)
만약 웹 서버를 우리가 직접 만들어야한다고 가정해보자
TCP 연결 대기를 걸고 요청 메세지를 파싱하고 POST 방식, /save URL 인지

여러 데이터를 쭉 파싱해서 저장 프로세스 실행 후 비지니스 로직 실행을 한다
HTTP 응답 메세지를 생성해서 다시 TCP 응답 전달을 한다.

여기서 우리가 필요한 과정은 비지니스 로직을 요청에 맞게 잘 실행하는 것이다.
비지니스 로직을 하는 핵심 부분이 아니라 다른 부가적인 TCP 대기 등 여러 과정을 대신하는 것
그것이 바로 서블릿이다.
간단한 서블릿 코드를 한번 보자

```java
@WebServlet(name="helloServelt", urlPatterns="/hello")
public class HelloeServelt extends HttpServelt{
	@Override
    protected void service(HttpServeltRequest request, HttpServletResponse response){
    //비지니스 로직 
    }
}
```
urlParttenrs의 URL이 호출되면 서블릿 코드가 실행
HTTP 요청 메세지를 HttpServeltRequest를 통해서 파싱해서 사용한다.
응답 메시지도 응답 정보 또한 서블릿에서도 제공한다.
HTTP 스펙을 서블릿을 통해서 쉽게 사용이 가능하다.

전체 응답 과정을 보자
![](https://velog.velcdn.com/images/kimdodo/post/9330292d-8e7a-4df8-a4ba-871c299cf384/image.png)

HTTP요청시
WAS는 리퀘스트,리스폰스 객체를 새로 만들어서 서블릿 객체를 호출
개발자는 리퀘스트객체에서 HTTP 요청 정보를 편리하게 꺼내서 사용
개발자는 리스폰스 객체에 HTTP 응답 정보를 입력
WAS는 리스폰스 객체에 담겨있는 내용으로 HTTP 응답 정보 생성 


## 서블릿 컨테이너
톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너 라고 한다.
서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출, 종료하는 생명주기 관리
서블릿객체는 싱글톤으로 관리한다.
- 고객의 요청이 올 때 마다 계속 객체를 생성하는 것은 비효율적이다.
- 최초 로딩 시점에 서블릿 객체를 미리 만들어두고 재사용 한다.
- 모든 고객 요청은 동일한 서블릿 객체 인스턴스에 접근
- 공유 변수 사용에 주의
- 서블릿 컨테이너 종료시 함께 종료

JSP도 서블릿으로 변환되어 사용
동시 요청을 위한 멀티 쓰레딩 처리 지원


## 동시요청 - 멀티 쓰레드
트래픽 문제를위해서 반드시 이해하고 있어야한다.

![](https://velog.velcdn.com/images/kimdodo/post/448c7452-fcaf-4154-902a-f88037038f42/image.png)
서블릿을 누가 호출하냐

### 쓰레드
애플리케이션 코드를 하나하나 순차적으로 실행하는 것은 쓰레드
자바 메인 메서드를 실행하면 main이라는 이름의 쓰레드가 실행
쓰레드가 없다면 자바 애플리케이션 실행 불가능
쓰레든느 한번에 하나의 코드 라인만 수행
동시 처리가 필요하면 쓰레드를 추가로 생성

### 다중 요청 - 쓰레드 1개 사용
![](https://velog.velcdn.com/images/kimdodo/post/f19f1caf-d8d3-40ca-b444-373a56329250/image.png)

위 예시의 경우로 쓰레드가 1개일때 가정 해보자
쓰레드가 요청 1번을 처리하는 과정에서 지연이 발생했다.
근데 요청 2가 동시에 들어오면 쓰레드가 아직 처리는 못한 지연 상태가 되어 두개의 요청 모두 응답하지 못하는 상태가 된다.

단순하게 생각하면 쓰레드를 하나 생성하면 된다.
![](https://velog.velcdn.com/images/kimdodo/post/99c34e3d-21be-45d9-b34c-142921059c95/image.png)
각 요청마다 쓰레드를 만드는 방식으로 한다면 해결된다.

요청 마다 쓰레드 생성시 장단점
장점 
- 동시 요청 처리 가능
리소스 혀용까지 처리 가능
하나의 쓰레드가 지연되도 나머지 쓰레드 정상 동작

단점 
- 스레드의 생성 비용은 비쌈 -> 요청마다 생성시 응답 속도 점차 지연
쓰레드의 컨택스트 수위칭 비용 발생
쓰레드의 생성에는 제한이 없어 리소스 임계점 초과시 서버 다운

### 스레드 풀
![](https://velog.velcdn.com/images/kimdodo/post/3bba7974-0877-45ce-90ca-45943861db5b/image.png)
1번 2번 요청이 들어오면 쓰레드 풀에서 쓰레드를 가져다가 요청을 처리하고 다시 반환한다.
쓰레드의 갯수 임계치 이상의 요청이 들어오면 쓰레드가 없어서 대기 하거나 거절 할 수 있다.

장단점

특징 
필요한 쓰레드를 쓰레드 풀에 보관하고 관리
쓰레드 풀에 생성 가능한 쓰레드의 최대치를 관리한다.
톰캣은 200개 최대가 기본 값

사용
쓰레드가 필요하면 생성되어 있는 쓰레드를 쓰레드풀에서 꺼내서 사용
사용 종료시 쓰레드 풀에 해당 쓰레드 반납
최대 쓰레드 사용이 되면 일정 숫자만큼 대기 또는 거절 가능

장점
생성 비용을 절약하고 응답 시간이 빠르다
생성가능한 쓰레드의 최대치가 있음으로 너무 많은 요청이 들어와도 기존 요청은 처리 가능

#### 실무팁
WAS의 주요 튜닝 포인트는 최대 쓰레드 수
낮게 설정하면 동시 요청이많으면 서버 리소스는 여유로운데 클라이언트의 응답 지연
너무 높게 설정하면 리소스 임계치 초과로 서버 다운

##### 장애 발생시??
클라우드라면 서버부터 늘리고 이후에 튜닝
클라우드가 아니면 미친듯이 튜닝해야한다.

### 적정 숫자
애플리케이션 로직의 복잡도, CPU, 메모리, IO리소스 사오항에 따라서 다 다르다.
성능 테스트가 반드시 필요하다
실제 서비스와 유사하게 성능테스트를 시도해야한다.
툴은 아파지 ab, 제이미터, nGrinder(영한님 추천) 이 3가지를 통해서 해보길
 
### 핵심
멀티 쓰레드에 대한 부분은 WAS가 처리한다.
개발자가 멀티 쓰레드 관련 코드를 신경쓰지 않아도 된다.
개발자는 싱글 쓰레드 프로그래밍을 하는 것 처럼 편리하게 소스코드를 개발 가능
멀티 쓰레드 환경임으로 서블릿, 스프링빈과 같은 싱글톤 객체는 주의해서 사용해야한다.
싱글톤에서 주의할 것은 공유 변수 이것이 굉장히 중요하다 

### 용어 정리
정적 리소스
고정된 HTML파일, CSS, JS, 이미지, 영상을 제공
주로 웹 브라우저
![](https://velog.velcdn.com/images/kimdodo/post/5c566b84-228b-4956-8cd9-512d8d37ef24/image.png)


HTML 페이지
동적으로 필요한 HTML 파일을 생성해서 전달
![](https://velog.velcdn.com/images/kimdodo/post/fd6a4cc3-1f18-4fa2-927b-1d9f445a4534/image.png)
이런 데이터를 동적으로 생성해서 보여주는 것

HTTP API
데이터를 전달하는 방식
주로 JSON을 사용
다양한 시스템에서 호출
앱클라이언트, 웹 클라이언트, 서버투서버 


UI 클라이언트 접점
앱 클라리언트(IOS/ 안드로이드 앱)
웹 브라우저의 JS를 통한 호출 -> 발전한 상태가 react vue
서버투 서버
주문 서버와 결제서버
기업간의 통신 등등

### SSR/CSR
서버 사이드 렌더링
![](https://velog.velcdn.com/images/kimdodo/post/063e0d3e-170a-4784-ae11-b54cfff2a31f/image.png)
서버 사이드 렌터링이란 서버에서 최종 HTML을 생성해서 클라이언트에 전달한다.
웹 브라우저는 단순하게 HTML을 보여주기만 하는 것이다.
즉 서버단에서 모든 HTML을 완성해서 서버사이드 렌더링이라고함

클라리언트 사이드 렌더링
HTML 결과를 자바 스크립트를 사용해서 웹 브라우저에서 동적으로 생성해서 적용
주로 동적인 화면에 사용, 웹 환경을 마치 앱처럼 필요한 부분을 변경 가능
구글 지도, GMail,구글 캘린터
React/Vue를 통해서 프론트개발하는것

![](https://velog.velcdn.com/images/kimdodo/post/d4efee35-e663-4d1d-8fa5-ad11d3e559d8/image.png)

### UI 기술 역량
백엔드 - 서버 사이드 렌더링 기술
JSP, 타임리프
화면이 정적이고 복잡하지 않을때 사용
백엔드 개발자는 서버 사이드 렌더링은 사용 가능해야한다.

FE - 클라이언트 사이드 렌더링
React,Vue
복잡하고 동적인 UI 사용
웹 프론트엔드 개발자의 전문 분야

선택과 집중
백엔드 개발자의 웹 프론트엔드 기술 학습은 옵션
백엔드 개발는 다른 DB, 서버, 인프라 기술도 공부해야함